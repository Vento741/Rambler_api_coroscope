# Интеграция с Telegram-ботом на платформе puzzlebot.top

## Настройка кнопки "Получить ответ" для Книги Перемен

Данная инструкция описывает, как настроить кнопку "Получить ответ" в Telegram-боте на платформе puzzlebot.top для отображения случайной гексаграммы из Книги Перемен (И-Цзин).

### 1. Создание кнопки в интерфейсе бота

1. Войдите в панель управления вашим ботом на puzzlebot.top
2. Перейдите в раздел "Кнопки" или "Меню"
3. Создайте новую кнопку с названием "Получить ответ" или "Гексаграмма И-Цзин"
4. В настройках кнопки укажите тип действия "HTTP-запрос"

### 2. Настройка HTTP-запроса

Для кнопки "Получить ответ" настройте следующие параметры:

- **URL запроса**: `http://81.177.6.93:8081/api/v1/book-czin/random`
- **Метод**: GET
- **Тип содержимого**: application/json
- **Заголовки**: не требуются дополнительные заголовки

### 3. Настройка переменных для отображения результата

После получения ответа от API, необходимо настроить переменные для отображения изображения и текста гексаграммы:

#### Переменные для изображения:

1. Создайте переменную `hexagram_image` с типом "Изображение"
2. В качестве источника выберите "Из ответа API"
3. Укажите путь к изображению в JSON: `data.image_url`

#### Переменные для текста:

1. Создайте переменную `hexagram_text` с типом "Текст"
2. В качестве источника выберите "Из ответа API"
3. Укажите путь к тексту в JSON: `data.formatted_text`

### 4. Настройка сообщения бота

Настройте сообщение, которое бот будет отправлять пользователю при нажатии на кнопку:

1. Создайте новый шаблон сообщения
2. Добавьте изображение, используя переменную `hexagram_image`
3. Добавьте текст, используя переменную `hexagram_text`
4. Настройте форматирование текста (поддерживается Markdown)

### Пример шаблона сообщения:

```
{hexagram_image}

{hexagram_text}
```

### 5. Обработка ошибок

Для корректной обработки возможных ошибок:

1. Создайте условие для проверки успешности запроса: `success` равно `true`
2. В случае ошибки (когда `success` равно `false`), настройте отправку альтернативного сообщения с текстом ошибки из поля `error`

### Важные замечания:

1. Убедитесь, что сервер API (81.177.6.93:8081) доступен и работает корректно.
2. Изображения гексаграмм доступны по прямым ссылкам вида `http://81.177.6.93:8081/api/v1/book-czin/image/{номер}`, где `{номер}` - это число от 1 до 64.
3. Текст гексаграммы форматирован с использованием Markdown, поэтому в настройках сообщения бота необходимо включить поддержку Markdown.

## Структура ответа API

Ответ API имеет следующую структуру:

```json
{
  "success": true,
  "data": {
    "number": 1,
    "title": "Творчество",
    "description": "Сила, творческая энергия, действие...",
    "image_url": "http://81.177.6.93:8081/api/v1/book-czin/image/1",
    "sections": {
      "Название": "Цянъ (Творчество): духовная сила...",
      "Определение": "Творчество означает силу.",
      "Символ": "Небо движется постоянно...",
      // Другие секции...
    },
    "formatted_text": "*1. Творчество*\nСила, творческая энергия, действие...\n\n*Название:* Цянъ (Творчество)..."
  },
  "error": null
}
```

В случае ошибки:

```json
{
  "success": false,
  "data": null,
  "error": "Описание ошибки"
}
```

## Тестирование интеграции

Для проверки работоспособности интеграции:

1. Опубликуйте изменения в вашем боте
2. Откройте бота в Telegram
3. Нажмите на кнопку "Получить ответ"
4. Убедитесь, что бот отправляет сообщение с изображением гексаграммы и её описанием

Если возникают проблемы с отображением изображения или текста, проверьте настройки переменных и пути в JSON. 